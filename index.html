<!DOCTYPE html>
<html>
<head>
    <title>Private Chat App</title>
    <style>
        body { font-family: Arial; display: flex; margin: 0; height: 100vh; }
        #users { width: 200px; border-right: 1px solid #ccc; padding: 10px; overflow-y: auto; }
        #chat { flex: 1; padding: 10px; display: flex; flex-direction: column; }
        #messages { flex: 1; overflow-y: auto; list-style: none; padding: 0; margin: 0; }
        #messages li { padding: 5px 10px; border-bottom: 1px solid #eee; }
        #form { display: flex; margin-top: 10px; }
        #input { flex: 1; padding: 10px; }
        #send { padding: 10px; }
        .user { cursor: pointer; padding: 5px; border-bottom: 1px solid #eee; }
        .user:hover { background: #f0f0f0; }
    </style>
</head>
<body>
    <div id="users">
        <h3>Users</h3>
        <ul id="userList"></ul>
    </div>
    <div id="chat">
        <ul id="messages"></ul>
        <form id="form">
            <input id="input" autocomplete="off" placeholder="Type a message..." />
            <button id="send">Send</button>
        </form>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-database.js"></script>
    <script>
        // Firebase config
        const firebaseConfig = {
          apiKey: "AIzaSyDGdH6XkMXh6pfqgsUx83L-mj8gdHNES90",
          authDomain: "application-b9db7.firebaseapp.com",
          databaseURL: "https://application-b9db7-default-rtdb.firebaseio.com",
          projectId: "application-b9db7",
          storageBucket: "application-b9db7.firebasestorage.app",
          messagingSenderId: "599892319079",
          appId: "1:599892319079:web:0741a03df8ab21633b2dc2",
          measurementId: "G-ZQ6749L2HJ"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const usersRef = db.ref('users');
        const chatsRef = db.ref('private_chats');

        let currentUser = { username: prompt("Enter your name:") || "Anonymous" };
        let currentUserId = usersRef.push().key;

        // Add current user
        usersRef.child(currentUserId).set({ username: currentUser.username });
        usersRef.child(currentUserId).onDisconnect().remove();

        const userList = document.getElementById('userList');
        const messages = document.getElementById('messages');
        const form = document.getElementById('form');
        const input = document.getElementById('input');

        let activeChatId = null;

        // Show users
        usersRef.on('value', snapshot => {
            userList.innerHTML = '';
            const users = snapshot.val();
            for (let id in users) {
                if (id === currentUserId) continue;
                const li = document.createElement('li');
                li.textContent = users[id].username;
                li.classList.add('user');
                li.onclick = () => selectUser(id, users[id].username);
                userList.appendChild(li);
            }
        });

        function selectUser(otherUserId, otherUsername) {
            messages.innerHTML = '';
            activeChatId = [currentUserId, otherUserId].sort().join('_');
            const chatRef = chatsRef.child(activeChatId).child('messages');
            chatRef.off();
            chatRef.on('child_added', snapshot => {
                const msg = snapshot.val();
                const li = document.createElement('li');
                li.textContent = `${msg.senderName}: ${msg.text}`;
                messages.appendChild(li);
                messages.scrollTop = messages.scrollHeight;
            });
        }

        // Send message
        form.addEventListener('submit', e => {
            e.preventDefault();
            if (!input.value.trim() || !activeChatId) return;
            const chatRef = chatsRef.child(activeChatId).child('messages');
            chatRef.push({
                senderId: currentUserId,
                senderName: currentUser.username,
                text: input.value,
                timestamp: Date.now()
            });
            input.value = '';
        });
    </script>
</body>
</html>
